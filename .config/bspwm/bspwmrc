#! /bin/sh

export LOGOUT_SCRIPT="bspc quit"
export LOCK_SCRIPT="magick $HOME/.scripts/current_wallpaper.png -resize 1920x $HOME/.scripts/current_wallpaper.png && i3lock -i $HOME/.scripts/current_wallpaper.png -ef"

#autostart
pgrep -x polybar > /dev/null || polybar &
pgrep -x xrdb > /dev/null || source $HOME/.bash_profile && xrdb $XRESOURCES &
pgrep -x sxhkd > /dev/null || sxhkd &
xsetroot -cursor_name left_ptr &
xset led 3 & # For generic led keyboards
pgrep -x picom > /dev/null || picom &
pgrep -x bg.sh > /dev/null || $HOME/.scripts/bg.sh &
pgrep -x nm-applet > /dev/null || nm-applet &
pgrep -x blueman-applet > /dev/null || blueman-applet &
pgrep -x c > /dev/null || caffeine start &
pgrep -x dunst > /dev/null || dunst &
pgrep -x redshift > /dev/null || redshift &
pgrep -f "low_battery.lua" > /dev/null || lua $HOME/.scripts/low_battery.lua &
touchegg_count=$(pgrep -xc touchegg)
[ "$touchegg_count" -le 1 ] && touchegg & # systemctl start touchegg counts as 1

pgrep polkit-gnome || /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1 &
dbus-update-activation-environment --systemd --all &
# pgrep -x xdman-beta > /dev/null || xdman-beta --background &

#bspwm
if [ -n "$(xrandr | grep "HDMI-1 connected")" ]; then
  bspc monitor eDP-1 -d 1 2 3 4 5 6 7 8
  bspc monitor HDMI-1 -d 9
else
  bspc monitor HDMI-1 -r
  bspc monitor eDP-1 -d 1 2 3 4 5 6 7 8 9
fi

bspc config border_width 1
bspc config window_gap 10

# bspc config split_ratio          0.5
bspc config borderless_monocle true
bspc config gapless_monocle true
bspc config focus_follows_pointer true
# bspc config pointer_follows_focus true
# bspc config pointer_follows_monitor true

bspc config focused_border_color \#9ABDF5
bspc config normal_border_color \#404E65FF

bspc rule -a zenity state=floating center=true
bspc rule -a Blueman-manager state=floating center=true
bspc rule -a xdman-Main state=floating center=true
bspc rule -a Localsend state=tiled
bspc config external_rules_command "$HOME/.config/bspwm/external_rules"

bsp-layout set tall 1 --master-size 0.55
bsp-layout set tall 2 --master-size 0.55
bsp-layout set tall 3 --master-size 0.55
bsp-layout set tall 4 --master-size 0.55
bsp-layout set tall 5 --master-size 0.55
bsp-layout set tall 6 --master-size 0.55
bsp-layout set tall 7 --master-size 0.55
bsp-layout set tall 8 --master-size 0.55
bsp-layout set tall 9 --master-size 0.55
